password: &password <your_password> # Set master password for kassio

home-assistant:
  enabled: true
  image:
    repository: homeassistant/raspberrypi4-homeassistant
    tag: 2021.9.6
  env:
    TZ: Europe/Madrid
  hostNetwork: true
  dnsPolicy: ClusterFirstWithHostNet
  ingress:
    main:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: traefik
  persistence:
    config:
      enabled: true
      type: pvc      
      size: 5Gi
      storageClass: local-path
      accessMode: ReadWriteOnce
      mountPath: /config
      
node-red:
  enabled: true
  image:
    repository: nodered/node-red
    tag: 2.0.6  
  env:
    TZ: Europe/Madrid
  hostNetwork: true
  dnsPolicy: ClusterFirstWithHostNet
  ingress:
    main:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: traefik
  persistence:
    data:
      enabled: true
      type: pvc      
      size: 5Gi
      storageClass: local-path
      accessMode: ReadWriteOnce
      mountPath: /data

mosquitto:
  enabled: true
  image:
    repository: eclipse-mosquitto
    tag: 2.0.12
  env:
    TZ: Europe/Madrid
  service:
    main:
      enabled: true
      type: NodePort
      ports:
        mqtt:
          enabled: true
          port: 1883
          nodePort: 32001
  persistence:
    data:
      enabled: true
      type: pvc      
      size: 5Gi
      storageClass: local-path
      accessMode: ReadWriteOnce
      mountPath: /mosquitto/data
    configinc:
      enabled: true
      type: pvc
      size: 100Mi
      storageClass: local-path
      accessMode: ReadWriteOnce
      mountPath: /mosquitto/configinc
    auth:
      enabled: true
      type: custom
      readOnly: true      
      volumeSpec:
        configMap:
          name: kassio-mosquitto-auth
      subPath: 
        - path: kassio.conf
          mountPath: /mosquitto/configinc/kassio.conf
        - path: kassio.pwd
          mountPath: /mosquitto/configinc/kassio.pwd
        - path: kassio.acl
          mountPath: /mosquitto/configinc/kassio.acl
  auth:  
    enabled: true
    conf: config/mosquitto/kassio.conf
    pwd: config/mosquitto/kassio.pwd
    acl: config/mosquitto/kassio.acl
    
zigbee2mqtt:
  enabled: false  
  image: 
    repository: koenkk/zigbee2mqtt
    tag: 1.21.1
  env:
    TZ: Europe/Madrid 
  ingress:
    main:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: traefik
  securityContext:
    privileged: true
  persistence:
    data:
      enabled: true
      type: pvc
      size: 2Gi                
      storageClass: local-path
      accessMode: ReadWriteOnce
      mountPath: /data
    usb:
      enabled: true
      type: hostPath
      hostPath: /dev/ttyACM0
      mountPath: /dev/ttyACM0
  config:
    serial:
      port: /dev/ttyACM0
    homeassistant: true
    mqtt:
      base_topic: zigbee
      server: "mqtt://kassio-mosquitto"
      user: zigbee
      password: *password      
    advanced:      
      homeassistant_discovery_topic: "home-assistant"
      homeassistant_status_topic: "home-assistant/status"
      network_key: [4, 1, 10, 4, 2, 14, 3, 6, 8, 8, 13, 11, 2, 9, 7, 15]
      channel: 11 # https://www.metageek.com/training/resources/zigbee-wifi-coexistence.html
    frontend:
      port: 8080
    experimental:
      new_api: true
    device_options:
      legacy: false # https://github.com/Koenkk/zigbee2mqtt/issues/7293#issuecomment-830848563
  nodeSelector:
    kassio/zigbee: "true"

zwave2mqtt:
  enabled: false  
  image:
    repository: robertslando/zwave2mqtt
    tag: 4.1.1
  env:
    TZ: Europe/Madrid  
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: traefik
  persistence:
    config:
      enabled: true
      size: 2Gi                
      storageClass: local-path
      accessMode: ReadWriteOnce
  # Path to your zigbee device in the container
  additionalVolumeMounts:
    - name: usb
      mountPath: /dev/ttyACM0
  # Path to your zigbee device on the host
  additionalVolumes:
    - name: usb
      hostPath:
        path: /dev/ttyACM0
  nodeSelector:
    kassio/zwave: "true"

frigate:
  enabled: false  
  image:
    repository: blakeblackshear/frigate
    tag: 0.9.0-rc4-aarch64
  env:
    TZ: Europe/Madrid 
    FRIGATE_RTSP_PASSWORD: *password
  service:
    main:
      ports:
        rtmp:
          enabled: true
  securityContext:
    privileged: true
  persistence:
    usb:
      enabled: true
      type: hostPath
      hostPath: /dev/bus/usb
      mountPath: /dev/bus/usb
    cache:
      enabled: true
      type: emptyDir
      medium: Memory
      sizeLimit: 1Gi # Memory/camera = (width * height * 3 + 270480)/1048576 = <shm size in mb>
      mountPath: /dev/shm  
  config: |
    detectors:
      coral:
        type: edgetpu
        device: usb
    mqtt:      
      host: kassio-mosquitto
      topic_prefix: "home-assistant/frigate"
      user: home-assistant
      password: '{FRIGATE_RTSP_PASSWORD}'
    ffmpeg:
      hwaccel_args:
        - -c:v
        - h264_v4l2m2m
    objects:
      track:
        - person
  nodeSelector:
    kassio/coral: "true"

monitoring:
  enabled: true
  grafana:
    adminPassword: *password
    ingress:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: traefik
    env:
      GF_SECURITY_ALLOW_EMBEDDING: true
  kubeEtcd:
    enabled: false
  prometheus:
    prometheusSpec:
      retention: 15d
      retentionSize: 5GiB
      storageSpec:
        volumeClaimTemplate:
          spec:
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 5Gi
            storageClassName: local-path
  alertmanager:
    enabled: false

logs:
  enabled: true    
  loki:
    persistence:
      enabled: true
      storageClassName: local-path
      size: 5Gi  

sai:
  enabled: false
  image:
    repository: ghcr.io/k8s-at-home/network-ups-tools
    tag: v2.7.4-2486-gaa0b3d1d
  env:
    TZ: Europe/Madrid
  securityContext:
    privileged: true
  persistence:
    usb:
      enabled: true
      type: hostPath
      hostPath: /dev/usb
      mountPath: /dev/usb  
  config:
    files:
      nut.conf: |
        MODE=standalone
      upsd.conf: |
        MAXAGE 15
        STATEPATH /var/run/nut
        LISTEN 0.0.0.0 3493
        MAXCONN 1024        
      ups.conf: |
        [salicru]
          driver = blazer_usb
          port = auto
          desc = "SPS ONE 500"
      upsd.users: |
        [admin]
          password = <pwd>
          actions = SET
          instcmds = ALL
      upsmon.conf: |
        MINSUPPLIES 1
  nodeSelector:
    kassio/sai: "true"

dns:
  enabled: true
  image:
    repository: adguard/adguardhome
    tag: v0.106.3
  env:
    TZ: Europe/Madrid
  hostNetwork: true
  dnsPolicy: ClusterFirstWithHostNet  
  ingress:
    main:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: traefik
  persistence:
    config:
      enabled: true
      type: pvc
      size: 100Mi
      storageClass: local-path
      accessMode: ReadWriteOnce
      mountPath: /opt/adguardhome/conf
    data:
      enabled: true
      type: pvc
      size: 100Mi
      storageClass: local-path
      accessMode: ReadWriteOnce
      mountPath: /opt/adguardhome/work

nfs:
  enabled: false